@{
  Layout = "_Layout";
}

@model Factory.Models.Category;
@using Factory.Models;
@using System.Collections.Generic;

<h2>Category Details</h2>
<hr />
<h3>@Html.DisplayNameFor(model => model.Name): @Html.DisplayFor(model => model.Name)<h3>

@if (@Model.Machines.Count == 0)
{
  <h3>No machines have been added to this category yet!</h3>
} 
else
{
  <h4>Machines the category contains:</h4>
  <ul>
    @foreach (Machine machine in Model.Machines)
    {
      string engineers = "";
      @if(machine.JoinEntities.Count == 0)
      {
        engineers = "This machine does not have any engineers.";
      }
      else
      {
        List<string> engineerList = new List<string>();
          @foreach (EngineerMachine join in machine.JoinEntities)
          {
            engineerList.Add(join.Engineer.Title);
          }
          engineers = String.Join(", ", engineerList);
      }
      <li>@machine.Description | @if(machine.Completed){<span>&#9989</span>} @if(!machine.Completed) {<span>Not Completed</span>} | Engineers: @engineers | Due Date: @machine.DueDate.ToShortDateString()</li>
    }

      <a name="date">@Html.ActionLink("Sort by date","Details", "Categories", new {sortBy = "date"})</a><br>
  </ul>
}

<p>@Html.ActionLink("Back to categories", "Index")</p>
<p>@Html.ActionLink("Edit Category", "Edit", new { id = Model.CategoryId })</p>
<p>@Html.ActionLink("Delete Category", "Delete", new { id = Model.CategoryId })</p>
<p>@Html.ActionLink("Add new machine", "Create", "Machines")</p>